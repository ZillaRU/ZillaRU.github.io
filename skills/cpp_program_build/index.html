<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Another iteration on the awesome Windmill theme for MkDocs"><meta name=author content="Zhongying Ru"><link href=https://ZillaRU.github.io/skills/cpp_program_build/ rel=canonical><link href=../bash_quickstart/ rel=prev><link href=../dockerfile_cheetsheet/ rel=next><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.5.0, mkdocs-material-9.1.20"><title>C++编译链接与构建系统详解：从g++到Make和CMake - Zilla0717</title><link rel=stylesheet href=../../assets/stylesheets/main.eebd395e.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ecc896b0.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=cyan data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#cgmakecmake class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=Zilla0717 class="md-header__button md-logo" aria-label=Zilla0717 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Zilla0717 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> C++编译链接与构建系统详解：从g++到Make和CMake </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=cyan data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=cyan data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ZillaRU/ZillaRU.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../reading/diffusion_model/ class=md-tabs__link> Reading </a> </li> <li class=md-tabs__item> <a href=../bash_quickstart/ class="md-tabs__link md-tabs__link--active"> Skills </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=Zilla0717 class="md-nav__button md-logo" aria-label=Zilla0717 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> Zilla0717 </label> <div class=md-nav__source> <a href=https://github.com/ZillaRU/ZillaRU.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Reading <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Reading </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reading/diffusion_model/ class=md-nav__link> 图像生成 X Diffusion model </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> Skills <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Skills </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../bash_quickstart/ class=md-nav__link> bash脚本编程速成 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> C++编译链接与构建系统详解：从g++到Make和CMake <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> C++编译链接与构建系统详解：从g++到Make和CMake </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#c class=md-nav__link> C++编译与链接过程 </a> </li> <li class=md-nav__item> <a href=#ggnu-c class=md-nav__link> g++：GNU C++编译器 </a> </li> <li class=md-nav__item> <a href=#make class=md-nav__link> make：自动化构建工具 </a> <nav class=md-nav aria-label=make：自动化构建工具> <ul class=md-nav__list> <li class=md-nav__item> <a href=#make_1 class=md-nav__link> make工具常用命令 </a> </li> <li class=md-nav__item> <a href=#makefile class=md-nav__link> Makefile的常见写法 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../dockerfile_cheetsheet/ class=md-nav__link> Dockerfile编写 </a> </li> <li class=md-nav__item> <a href=../docker%E4%BD%BF%E7%94%A8/ class=md-nav__link> Docker使用 </a> </li> <li class=md-nav__item> <a href=../mkdocs%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/ class=md-nav__link> Mkdocs简明教程 </a> </li> <li class=md-nav__item> <a href=../pdb_cheetsheet/ class=md-nav__link> pdb调试方法及高级使用技巧 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#c class=md-nav__link> C++编译与链接过程 </a> </li> <li class=md-nav__item> <a href=#ggnu-c class=md-nav__link> g++：GNU C++编译器 </a> </li> <li class=md-nav__item> <a href=#make class=md-nav__link> make：自动化构建工具 </a> <nav class=md-nav aria-label=make：自动化构建工具> <ul class=md-nav__list> <li class=md-nav__item> <a href=#make_1 class=md-nav__link> make工具常用命令 </a> </li> <li class=md-nav__item> <a href=#makefile class=md-nav__link> Makefile的常见写法 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ZillaRU/ZillaRU.github.io/edit/master/docs/skills/cpp_program_build.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <a href=https://github.com/ZillaRU/ZillaRU.github.io/raw/master/docs/skills/cpp_program_build.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg> </a> <h1 id=cgmakecmake>C++编译链接与构建系统详解：从g++到Make和CMake</h1> <blockquote> <p>g++ 是编译器，直接处理代码的编译和链接；make 是一个构建工具，自动化了使用 g++ 的构建过程；而 CMake 是一个构建系统生成器，它可以创建用于不同平台和构建工具的构建文件，使得跨平台构建和项目维护更加容易。在复杂项目中，CMake 和 make 通常一起使用，CMake 生成 Makefile，然后 make 根据这些文件来编译和链接项目。</p> </blockquote> <h2 id=c>C++编译与链接过程</h2> <p>C++的编译过程可以分为四个主要步骤：预处理、编译、汇编和链接。 - 预处理：预处理器处理源代码文件，处理所有以#开头的指令，如宏定义和文件包含。 - 编译：编译器将预处理后的代码转换成汇编指令。 - 汇编：汇编器将汇编指令转换为机器可读的二进制指令（目标代码）。 - 链接：链接器将多个目标代码文件合并，并解决代码之间的引用和依赖，生成最终的可执行文件。</p> <h2 id=ggnu-c>g++：GNU C++编译器</h2> <p>g++是GNU项目的C++编译器，它可以自动完成上述的编译链接过程。一个简单的使用示例如下：</p> <pre><code class=language-bash>g++ -c source1.cpp -o source1.o
g++ -c source2.cpp -o source2.o
g++ source1.o source2.o -o application
</code></pre> <p>这里，-c标志告诉g++仅进行编译不进行链接，生成.o目标文件；最后一个命令则进行链接，生成可执行文件application。</p> <ul> <li>常用的选项：<ul> <li><code>-c</code>：只编译和汇编，但不链接。</li> <li><code>-g</code>：包含调试信息，这对于使用gdb等调试工具很有用。</li> <li><code>-Wall</code>、<code>-Wextra</code>、<code>-Werror</code>：打开额外的警告，将警告视为错误。</li> <li><code>-O0</code>、<code>-O1</code>、<code>-O2</code>、<code>-O3</code>：设置不同的优化级别。</li> <li><code>-std=c++11</code>、<code>-std=c++14</code>、<code>-std=c++17</code>：指定使用特定的C++标准。</li> </ul> </li> <li>例子<ul> <li>编译单个文件：<code>g++ -c file.cpp</code>，只编译file.cpp，生成file.o目标文件，但不进行链接。</li> <li>编译并链接多个文件：<code>g++ file1.cpp file2.cpp -o app</code>，编译并链接file1.cpp和file2.cpp，生成可执行文件app。</li> <li>设置优化级别：<code>g++ -O2 file.cpp -o app</code>，-O2选项启用了中等优化，通常用于生产编译，以保证代码执行的效率。</li> <li>启用所有警告并处理警告为错误：<code>g++ -Wall -Werror file.cpp -o app</code>，-Wall打开所有的警告，-Werror将所有警告当作错误处理。</li> <li>指定标准库版本：<code>g++ -std=c++17 file.cpp -o app</code>，-std=c++17指定使用C++17标准进行编译。</li> <li>链接库文件：<code>g++ file.cpp -o app -L/lib/dir -lname</code>，-L用于指定库文件搜索目录，-l用于指定链接的库名。</li> </ul> </li> </ul> <h2 id=make>make：自动化构建工具</h2> <p>在简单的项目中，你可以直接使用 g++ 命令来编译和链接你的程序，但这种方法在项目变得更加复杂时会变得难以管理。Make工具和Makefile脚本可以自动化编译和链接过程。</p> <p>Make 是一个工具，它使用一个名为 Makefile 的文件，该文件定义了如何编译和链接程序。Makefile 包含了一系列的规则和依赖关系，告诉 make 如何构建目标（如可执行文件或库）。</p> <p>使用 make 的优势包括： - 自动化构建：你只需输入 make 命令，它就会根据 Makefile 中的规则自动编译和链接源代码。 - 增量构建：make 可以检测哪些文件被修改，并且只重新编译那些改变了的文件，这可以节省大量的构建时间。 - 定制化构建规则：你可以在 Makefile 中编写复杂的规则，以处理特殊的构建需求。</p> <h3 id=make_1>make工具常用命令</h3> <ul> <li>运行默认目标：<code>make</code></li> <li>运行特定目标：<code>make target_name</code></li> <li>清理构建产物：<code>make clean</code></li> </ul> <h3 id=makefile>Makefile的常见写法</h3> <p>Makefile 是 Make 工具使用的文件，用于自动化编译和链接程序。它定义了一系列的规则来指定如何生成目标文件和执行任务。</p> <ul> <li> <p>基本组成</p> <ul> <li>目标（Targets）：通常是文件名，代表了构建系统需要创建的文件。</li> <li>依赖（Dependencies）：目标文件依赖的文件列表，这些文件是生成目标所需的。</li> <li>规则（Rules）：如何从依赖生成目标的具体命令。</li> </ul> </li> <li> <p>格式 <code>makefile target: dependencies recipe</code></p> <ul> <li>target：你想要生成的文件。</li> <li>dependencies：生成该目标所需要的文件或目标。</li> <li>recipe：生成目标所需执行的命令，必须以一个Tab键开始。</li> </ul> </li> <li> <p>一个例子</p> <p>```makefile</p> <h1 id=_1>变量定义</h1> <p>CC=gcc CFLAGS=-I.</p> <p>app: main.o utils.o $(CC) main.o utils.o -o app # 使用变量 $(varname)</p> <p>main.o: main.c $(CC) -c main.c</p> <p>utils.o: utils.c $(CC) -c utils.c</p> <p>clean: rm -f *.o app ```</p> <p>在这个例子中，目标 app 依赖于 main.o 和 utils.o。<code>make app</code>会编译这两个对象文件，并链接它们生成最终的可执行文件 app。<code>make clean</code>会清理所有构建生成的文件。</p> </li> </ul> <h2 id=cmake>CMake：跨平台构建系统</h2> <p>编写和维护 Makefile 可能会变得复杂，尤其是在跨平台的项目中。CMake是一个更高级别的构建系统，它使用平台无关的 CMakeLists.txt 文件来描述构建过程，并且可以生成适用于不同平台的 Makefile 或其他构建脚本。</p> <p>CMake 的优势包括： - 跨平台支持：CMake 可以为多种平台生成构建文件，包括 Unix、Windows 和 macOS。 - 易于维护：CMakeLists.txt 文件通常比 Makefile 更简洁、更易于理解和维护。 - 高级功能：CMake 提供了高级功能，如自动查找库依赖、生成安装脚本、进行测试等。 - IDE集成：许多集成开发环境（IDE）支持 CMake，可以直接从 CMakeLists.txt 文件中导入项目。</p> <h3 id=_2>常用命令</h3> <ul> <li>生成构建系统文件：<code>cmake path_to_source</code></li> <li>构建项目（在构建目录中）：<code>cmake --build .</code></li> <li>指定构建类型（例如：Release或Debug）：<code>cmake -DCMAKE_BUILD_TYPE=Release path_to_source</code></li> </ul> <h3 id=cmakeliststxt>CMakeLists.txt写法</h3> <p>CMakeLists.txt文件用于定义构建过程。</p> <h4 id=_3>基本命令</h4> <ul> <li><code>cmake_minimum_required</code>、<code>project</code>、<code>set</code> 等命令用于设置项目的基本信息。</li> <li>指定C++标准：<code>set</code>命令用于指定所需的C++标准。</li> <li>添加可执行文件：</li> <li><code>add_executable</code> 命令用于定义一个从源文件构建的可执行文件。</li> <li>添加库文件： <code>add_library</code> 命令用于创建一个库（动态或静态）。</li> <li>链接库： <code>target_link_libraries</code> 命令用于指定可执行文件或库需要链接的其他库。</li> </ul> <h4 id=_4>高级功能</h4> <ul> <li>定义变量：使用set命令可以定义一个变量。<code>set(MY_VARIABLE "SomeValue")</code>；之后，你可以使用<code>${MY_VARIABLE}</code>来引用这个变量的值。</li> <li>使用条件语句进行条件编译或配置： <code>cmake if(MY_VARIABLE STREQUAL "Hello, CMake!") message(STATUS "Variable is set correctly.") else() message(STATUS "Variable is not set correctly.") endif()</code></li> <li> <p>定义函数：CMake允许你定义自己的函数，这对于复用代码非常有用。 <code>cmake function(my_function arg1 arg2) message(STATUS "Calling my_function with arguments: ${arg1} and ${arg2}") # 函数内部的其他命令... endfunction()</code> 然后，你可以像这样调用你的函数： <code>my_function(Value1 Value2)</code></p> </li> <li> <p>命令行设置参数：在命令行中，你可以通过传递-D选项给cmake命令来设置参数。 <code>cmake -DMY_VARIABLE=MyValue path_to_source</code>，这将在CMake的配置阶段设置MY_VARIABLE为MyValue。</p> </li> </ul> <h3 id=cmakeliststxt_1>处理嵌套文件夹和多个CMakeLists.txt文件</h3> <p>当你的项目结构变得更加复杂，包含多个目录时，你通常会在每个目录中放置一个CMakeLists.txt文件。CMake支持在主CMakeLists.txt文件中使用add_subdirectory命令来包含这些子目录。</p> <p>每个子目录的CMakeLists.txt将定义该目录中的构建规则。这样，你可以组织代码和构建逻辑，使它们局部化和模块化。</p> <p>假设你有一个项目，它的结构如下：</p> <pre><code class=language-bash>/MyProject
  CMakeLists.txt
  /src
    CMakeLists.txt
    main.cpp
  /lib
    CMakeLists.txt
    mylib.cpp
</code></pre> <p>在根目录的CMakeLists.txt中，你会包含src和lib目录：</p> <pre><code class=language-cmake>cmake_minimum_required(VERSION 3.10)
project(MyProject VERSION 1.0)

# 添加子目录
add_subdirectory(src)
add_subdirectory(lib)
</code></pre> <p>在src目录的CMakeLists.txt中，你可能会添加一个可执行文件：</p> <pre><code class=language-cmake>add_executable(program main.cpp)

# 假设我们想链接在lib目录中定义的库
target_link_libraries(program PRIVATE mylib)
</code></pre> <p>在lib目录的CMakeLists.txt中，你可以添加一个库：</p> <pre><code class=language-cmake>add_library(mylib STATIC mylib.cpp)
</code></pre> <p>CMake会递归地处理这些CMakeLists.txt文件，根据每个目录中定义的规则来构建项目。</p> <h3 id=cmake_1>.cmake 文件</h3> <p>.cmake 文件是CMake的模块或脚本文件，它包含了可以被CMake进程所使用的CMake命令和宏定义。这些文件通常用于以下几个目的：</p> <ul> <li> <p>模块(Module): CMake模块是包含了一组预先定义的函数和宏的文件，这些可以被其他CMake脚本通过<code>include()</code>或<code>find_package()</code>命令所使用。模块通常用于查找库文件、程序、线程等，并且可以设置必要的编译器标志或变量。</p> </li> <li> <p>包配置文件(Package Configuration): 这些.cmake文件提供了包的配置信息，使得其他项目可以通过<code>find_package()</code>命令找到并正确链接使用这些包。</p> </li> <li> <p>工具链文件(Toolchain Files): 当进行交叉编译时，工具链文件包含了必须由CMake使用的编译器和工具的信息。</p> </li> <li> <p>包含文件(Include Files): 与编程语言中的头文件类似，.cmake文件可以被其他CMake脚本包含，以复用代码和逻辑。</p> </li> <li> <p>脚本(Scripts): .cmake 文件也可以包含可以独立执行的CMake脚本，这些脚本可以执行特定任务，如安装脚本、测试脚本等。</p> </li> </ul> <p>在项目中，.cmake 文件通常被组织在项目的cmake目录下，并且在<code>主CMakeLists.txt</code>文件或<code>其他CMakeLists.txt</code>文件中通过相应的命令引入。这样做可以提高项目的可维护性和模块化水平，也便于共享和重用CMake代码。</p> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../bash_quickstart/ class="md-footer__link md-footer__link--prev" aria-label="Previous: bash脚本编程速成" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> bash脚本编程速成 </div> </div> </a> <a href=../dockerfile_cheetsheet/ class="md-footer__link md-footer__link--next" aria-label="Next: Dockerfile编写" rel=next> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Dockerfile编写 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.220ee61c.min.js></script> </body> </html>